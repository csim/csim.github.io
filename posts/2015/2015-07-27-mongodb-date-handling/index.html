<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<title>MongoDB .Net Driver date handling · Clint Simon</title>
<meta name=HandheldFriendly content="True">
<meta name=viewport content="width=device-width,initial-scale=1">
<link rel=stylesheet href=https://csim.github.io/style.main.min.5ea2f07be7e07e221a7112a3095b89d049b96c48b831f16f1015bf2d95d914e5.css>
</head>
<body class=post-template>
<div class=site-wrapper>
<header class=site-header><div class="outer site-nav-main">
<div class=inner><nav class=site-nav>
<div class=site-nav-left>
<a class=site-nav-logo href=https://csim.github.io>Clint Simon</a>
<div class=site-nav-content>
<ul class=nav role=menu>
<li class=nav-home role=menuitem><a href=https://twitter.com/clintsim>@clintsim</a></li>
<li class=nav-home role=menuitem><a href=/posts/>All Posts</a></li>
</ul>
</div>
</div>
</nav>
</div>
</div></header>
<main id=site-main class="site-main outer">
<div class=inner>
<article class="post-full post no-image">
<header class=post-full-header>
<section class=post-full-tags>
<a href=/tags/mongodb>MongoDB</a>
</section>
<h1 class=post-full-title>MongoDB .Net Driver date handling</h1>
<div class=post-full-byline>
<section class=post-full-byline-content>
<section class=post-full-byline-meta>
<div class=byline-meta-content>
<time class=byline-meta-date datetime=2015-87-07>27 July 2015</time>
<span class=byline-reading-time><span class=bull>&bull;</span> 1 min read</span>
</div>
</section>
</section>
</div>
</header>
<section class=post-full-content>
<div class=post-content>
<p>I ran into an interesting situation when saving dated to MongoDB using the Mongo .Net driver (version 2.0).</p>
<p>When saving a date with <a href="https://msdn.microsoft.com/en-us/library/system.datetime.kind%28v=vs.110%29.aspx">unspecified kind</a>, the driver converts the date to a universal datetime. It appears that the driver will assume that a DateTime object with an unspecified kind is a local time, and convert it to universal time (UTC) before committing it to the database.</p>
<p>In my particular case, my origin date was UTC and was read from SQL server. Because entity framework does not set the Kind property on DateTime fields, MongoDB assuming these dates are local and performed a conversion to UTC. (Arrghhh)</p>
<p>Moral of the story: if you are converting data from SQL Server to MongoDB, make sure to call .ToLocalTime() on all dates even if they are stored as UTC. This will set the DateTime kind to local and avoid an inadvertent conversion by MongoDB on commit.</p>
<p>EDIT: As Robert suggests below, it is better to set the Kind on the DateTime because of possible UTC/Local conversion issues. Sample:</p>
<pre tabindex=0><code>var unspecifiedDateTime = ...; // returned by Entity Framework
var utcDateTime = DateTime.SpecifyKind(unspecifiedDateTime, DateTimeKind.Utc);
</code></pre>
</div>
</section>
</article>
</div>
</main>
<aside class="read-next outer">
<div class=inner>
<div class=read-next-feed>
<article class=read-next-card>
<header class=read-next-card-header>
<h3><span>More in</span> <a href=/tags/mongodb>MongoDB</a></h3>
</header>
<div class=read-next-card-content>
<ul>
</ul>
</div>
</article>
<article class="post-card post
no-image">
<div class=post-card-content>
<a class=post-card-content-link href=https://csim.github.io/posts/2014/2014-10-17-dropzone-knockout-binding/>
<header class=post-card-header>
<div class=post-card-primary-tag>Programming</div>
<h2 class=post-card-title>Dropzone knockout binding</h2>
</header>
<section class=post-card-excerpt>
<p>A very simple knockout binding for dropzone.</p>
</section>
</a>
<footer class=post-card-meta>
<ul class=author-list>
<li class=author-list-item>
<div class=author-name-tooltip></div>
<a href=# class="static-avatar author-profile-image"><img src=https://en.gravatar.com/userimage/151426551/fe908c49a44a5f01332d9c7c960bf567.png>
</a>
</li>
</ul>
<div class=post-card-byline-content>
<span></span>
<span class=post-card-byline-date><time datetime=2014-810-10>17 October 2014</time>
<span class=bull>&bull;</span> 1 min read</span>
</div>
</footer>
</div>
</article>
<article class="post-card post
no-image">
<div class=post-card-content>
<a class=post-card-content-link href=https://csim.github.io/posts/2016/2016-evolve-complexity/>
<header class=post-card-header>
<h2 class=post-card-title>Evolve the product toward complexity</h2>
</header>
<section class=post-card-excerpt>
<p>Managing a product is hard. Ideas come from all angles, many of them have merit and worst of all you don’t generally have enough direct feedback to make an informed decision about which ideas carry the most value.
There is an inherit danger in committing resources toward too many features. Time is finite and the team is small. Picking the wrong features means potentially confusing users or failing to attract users in the first place.</p>
</section>
</a>
<footer class=post-card-meta>
<ul class=author-list>
<li class=author-list-item>
<div class=author-name-tooltip>Clint Simon</div>
<a href=# class="static-avatar author-profile-image"><img src=https://en.gravatar.com/userimage/151426551/fe908c49a44a5f01332d9c7c960bf567.png>
</a>
</li>
</ul>
<div class=post-card-byline-content>
<span>Clint Simon</span>
<span class=post-card-byline-date><time datetime=2016-21-01>16 January 2016</time>
<span class=bull>&bull;</span> 1 min read</span>
</div>
</footer>
</div>
</article>
</div>
</div>
</aside>
<footer class="site-footer outer">
<div class="site-footer-content inner">
<section class=copyright><a href=https://csim.github.io>Clint Simon</a> &copy; 2015</section>
<nav class=site-footer-nav>
<a href=https://csim.github.io>Latest Posts</a>
<a href=https://twitter.com/clintsim target=_blank rel=noopener>Twitter</a>
<a href=https://github.com/csim target=_blank rel=noopener>Github</a>
</nav>
</div>
</footer>
</div>
</body>
</html>